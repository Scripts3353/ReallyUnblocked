<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - ReallyUnb0ck3d</title>
<style>
:root{--p1:#4b0082;--p2:#240046}
body{margin:0;font-family:Arial;height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--p1),var(--p2));color:#fff}
.card{width:360px;background:rgba(0,0,0,0.45);padding:22px;border-radius:12px}
input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:#fff}
button{width:100%;padding:10px;border-radius:8px;border:none;background:#9d4edd;color:#fff;font-weight:700;cursor:pointer;margin-top:8px}
.small{font-size:13px;opacity:0.9;margin-top:8px}
.list{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;margin-top:8px;max-height:140px;overflow:auto;font-size:13px}
.bad{color:#ff8b8b}
.good{color:#b7ffb7}
</style>
</head>
<body>
<div class="card">
  <h2>ReallyUnb0ck3d â€” Login</h2>
  <input id="username" placeholder="username or email" autocomplete="off">
  <input id="password" type="password" placeholder="password" autocomplete="off">
  <button id="loginBtn">Sign in</button>
  
  <div class="small">One-time generated logins (single-use). Use the one-time credential below to login once.</div>
  <div id="oneTimeList" class="list">Loading...</div>
</div>

<script>
const oneTimeList = document.getElementById('oneTimeList');
const loginBtn = document.getElementById('loginBtn');

async function fetchOneTime() {
    try {
        const res = await fetch('/api/list');
        if(!res.ok) throw new Error('Failed to fetch');
        const data = await res.json();
        const items = data.oneTime.map(o => {
            const status = o.used ? '<span class="bad">USED</span>' : '<span class="good">ACTIVE</span>';
            return `${o.username} / ${o.password} - ${status}`;
        });
        oneTimeList.innerHTML = items.join('<br>');
    } catch(e) {
        oneTimeList.innerHTML = 'Error loading one-time logins';
        console.error(e);
    }
}

fetchOneTime();

loginBtn.addEventListener('click', async ()=>{
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username||!password){ alert('Enter username & password'); return; }

    try {
        const res = await fetch('/api/login', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({username,password})
        });
        const data = await res.json();
        if(data.ok){
            localStorage.setItem('deviceId', data.deviceId);
            localStorage.setItem('isAdmin', data.isAdmin? 'true':'false');
            window.open('about:blank','_blank');
            window.location.href = '/site.html';
        } else {
            alert('Login failed: ' + (data.error||'Unknown error'));
        }
    } catch(e){
        alert('Error connecting to server');
        console.error(e);
    }
});
</script>
</body>
</html>

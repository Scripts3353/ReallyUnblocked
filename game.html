<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game</title>
<style>
body, html { margin:0; padding:0; height:100%; background:#111; color:white; font-family:Arial,sans-serif; }
#gameContainer { position:relative; width:100%; height:100%; }
iframe { width:100%; height:100%; border:none; }
#bar { position:absolute; top:0; left:0; width:100%; height:50px; background:#2e2e4f; display:flex; align-items:center; gap:10px; padding:0 10px; box-sizing:border-box; z-index:100; }
#bar button { background:#4b2e83; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:5px; transition:0.3s; }
#bar button:hover { background:#ffcc00; color:black; }
#overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:purple; display:flex; justify-content:center; align-items:center; flex-direction:column; color:white; font-size:2rem; display:none; z-index:200; }
</style>
</head>
<body>

<div id="gameContainer">
    <div id="bar">
        <button onclick="closeGame()">Close</button>
        <button onclick="fullscreenGame()">Fullscreen</button>
        <button onclick="openNewTab()">Open in New Tab</button>
    </div>
    <iframe id="gameFrame" src=""></iframe>
    <div id="overlay">
        <div id="overlayText">Checking player data...</div>
    </div>
</div>

<script>
// Get game file from query
const params = new URLSearchParams(window.location.search);
const gameFile = params.get('file') || '';
const iframe = document.getElementById('gameFrame');
iframe.src = gameFile;

// Helpers
function closeGame(){ window.location.href='index.html'; }
function fullscreenGame(){ iframe.requestFullscreen(); }
function openNewTab(){ window.open(gameFile,'_blank'); }

// LocalStorage helpers
const gameKey = 'gameData_' + gameFile;

function saveData(){
    const data = prompt("Enter your data for this game:");
    if(data){
        let saved = JSON.parse(localStorage.getItem(gameKey) || "[]");
        saved.push(data);
        localStorage.setItem(gameKey, JSON.stringify(saved));
        alert("Data saved!");
        updateDropdown();
    }
}

function loadData(){
    const select = document.getElementById('savedDataSelect');
    const value = select.value;
    if(!value) return;
    // Show overlay
    const overlay = document.getElementById('overlay');
    const overlayText = document.getElementById('overlayText');
    overlay.style.display = 'flex';
    overlayText.textContent = 'Checking player data...';
    setTimeout(()=>{
        overlayText.textContent = 'Player data found! Now loading...';
        setTimeout(()=>{
            overlay.style.display = 'none';
            alert('Data loaded: ' + value);
            // Here you can actually load the data into the game if needed
        }, 5000);
    }, 10000);
}

// Populate dropdown
function updateDropdown(){
    const select = document.getElementById('savedDataSelect');
    select.innerHTML = '<option value="">Select saved data</option>';
    const saved = JSON.parse(localStorage.getItem(gameKey) || "[]");
    saved.forEach(item=>{
        const opt = document.createElement('option');
        opt.value = item;
        opt.textContent = item;
        select.appendChild(opt);
    });
}

// Initialize dropdown
updateDropdown();
</script>

</body>
</html>
